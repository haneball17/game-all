# AradVision ä¸ game-all åä½œæ¥å£åè®®è§„èŒƒ

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

| å±æ€§ | å€¼ |
|------|------|
| **åè®®åç§°** | HelperStatus V6 + HelperControl V5 |
| **ç‰ˆæœ¬å·** | V1.0 |
| **æ—¥æœŸ** | 2025-02-27 |
| **çŠ¶æ€** | è‰æ¡ˆ |
| **ç»´æŠ¤æ–¹** | AradVision é¡¹ç›®ç»„ |
| **åä½œæ–¹** | game-all é¡¹ç›®ç»„ |

---

## ğŸ¯ åè®®æ¦‚è¿°

### è®¾è®¡ç›®æ ‡

æœ¬åè®®å®šä¹‰ **AradVisionï¼ˆPython Botï¼‰** ä¸ **game-allï¼ˆC++ è¾…åŠ©å·¥å…·ï¼‰** ä¹‹é—´çš„æ•°æ®äº¤æ¢è§„èŒƒï¼Œå®ç°ï¼š

1. **æ¸¸æˆçŠ¶æ€å…±äº«**ï¼šC++ â†’ Pythonï¼ˆæˆ¿é—´æ¸…ç©ºã€é—¨å¼€å¯ã€æ€ªç‰©æ•°é‡ï¼‰
2. **è¿‡å›¾æ§åˆ¶**ï¼šPython â†’ C++ï¼ˆè§¦å‘è¿‡å›¾CALLï¼Œå‚æ•°ï¼šä¸Š/ä¸‹/å·¦/å³ï¼‰

### é€šä¿¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Windows å…±äº«å†…å­˜                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ game-all (C++)      â”‚         â”‚ AradVision (Python) â”‚    â”‚
â”‚  â”‚                     â”‚         â”‚                     â”‚    â”‚
â”‚  â”‚ game-payload.dll    â”‚         â”‚ core/cpp_bridge.py  â”‚    â”‚
â”‚  â”‚                     â”‚         â”‚                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚             â”‚                                â”‚               â”‚
â”‚             â”‚ å†™å…¥çŠ¶æ€                       â”‚ è¯»å–çŠ¶æ€       â”‚
â”‚             â–¼                                â–²               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚               â”‚
â”‚  â”‚ HelperStatusV6      â”‚                   â”‚               â”‚
â”‚  â”‚ (168 bytes)         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚  â”‚                     â”‚                                   â”‚
â”‚  â”‚ - RoomCleared       â”‚                                   â”‚
â”‚  â”‚ - DoorOpen          â”‚                                   â”‚
â”‚  â”‚ - MonsterCount      â”‚                                   â”‚
â”‚  â”‚ - MapTeleportReady  â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚             â–²                                                â”‚
â”‚             â”‚ è¯»å–æ§åˆ¶                                       â”‚
â”‚             â”‚                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚               â”‚
â”‚  â”‚ HelperControlV5     â”‚                   â”‚               â”‚
â”‚  â”‚ (60 bytes)          â”‚                   â”‚               â”‚
â”‚  â”‚                     â”‚                   â”‚               â”‚
â”‚  â”‚ - TeleportDirection â”‚                   â”‚               â”‚
â”‚  â”‚ - TeleportTrigger   â”‚                   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚               â”‚
â”‚             â”‚                                â”‚               â”‚
â”‚             â”‚ å†™å…¥æ§åˆ¶                       â”‚                â”‚
â”‚             â–¼                                â”‚               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ C++ æ‰§è¡Œè¿‡å›¾CALL     â”‚         â”‚ Python æ£€æµ‹é—¨æ–¹å‘    â”‚    â”‚
â”‚  â”‚ (ä¸Š/ä¸‹/å·¦/å³)        â”‚         â”‚ (è§†è§‰è¯†åˆ«)           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯çº¦æŸ

| å±æ€§ | å€¼ | è¯´æ˜ |
|------|------|------|
| **å¹³å°** | Windows x86 | 32ä½ç³»ç»Ÿ |
| **é€šä¿¡æ–¹å¼** | å‘½åå…±äº«å†…å­˜ | Named Shared Memory |
| **å­—èŠ‚åº** | å°ç«¯åº | Little-Endian |
| **å†…å­˜å¯¹é½** | Pack = 1 | ç¦æ­¢è‡ªåŠ¨å¯¹é½ |
| **å‘½åç©ºé—´** | `Local\` ä¼˜å…ˆ | åŒä¸€ä¼šè¯è¿›ç¨‹é€šä¿¡ |

---

## ğŸ“¦ åè®®å®šä¹‰

### é€šé“ä¸€ï¼šHelperStatusV6ï¼ˆçŠ¶æ€é€šé“ï¼‰

**ç”¨é€”**ï¼šgame-all â†’ AradVisionï¼ŒæŠ¥å‘Šæ¸¸æˆçŠ¶æ€

#### å‘½åè§„åˆ™

```
Local\GameHelperStatus_{pid}
Global\GameHelperStatus_{pid}
```

- **ä¼˜å…ˆçº§**ï¼šLocal ä¼˜å…ˆï¼ŒGlobal å…œåº•
- **å ä½ç¬¦**ï¼š`{pid}` ä¸ºç›®æ ‡æ¸¸æˆè¿›ç¨‹ ID

#### ç»“æ„ä½“å®šä¹‰

**C++ ç‰ˆæœ¬**ï¼š

```cpp
#pragma pack(push, 1)
struct HelperStatusV6 {
    // ========== V5 åŸæœ‰å­—æ®µï¼ˆ0-151 å­—èŠ‚ï¼‰==========
    uint32_t Version;                    // = 6
    uint32_t Size;                       // = 168
    uint64_t LastTickMs;                 // å¿ƒè·³æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
    uint32_t Pid;                        // ç›®æ ‡è¿›ç¨‹ PID
    int32_t ProcessAlive;                // è¿›ç¨‹å­˜æ´»æ ‡è®°ï¼ˆ0/1ï¼‰
    int32_t AutoTransparentEnabled;      // è‡ªåŠ¨é€æ˜å¼€å…³
    int32_t FullscreenAttackTarget;      // å…¨å±æ”»å‡»ç›®æ ‡å¼€å…³
    int32_t FullscreenAttackPatchOn;     // å…¨å±æ”»å‡»è¡¥ä¸çŠ¶æ€
    int32_t AttractMode;                 // å¸æ€ªæ¨¡å¼
    int32_t AttractPositive;             // å¸æ€ªæ–¹å‘
    int32_t GatherItemsEnabled;          // èšç‰©å¼€å…³
    int32_t DamageEnabled;               // åŠ¨æ€å€æ”»å¼€å…³
    int32_t DamageMultiplier;            // åŠ¨æ€å€æ”»å€ç‡ï¼ˆ1~1000ï¼‰
    int32_t InvincibleEnabled;           // æ€ªç‰©é›¶ä¼¤å¼€å…³
    int32_t SummonEnabled;               // å¬å”¤å¼€å…³
    uint64_t SummonLastTick;             // å¬å”¤æœ€åè§¦å‘æ—¶é—´
    int32_t FullscreenSkillEnabled;      // å…¨å±æŠ€èƒ½å¼€å…³
    int32_t FullscreenSkillActive;       // å…¨å±æŠ€èƒ½æ¿€æ´»çŠ¶æ€
    uint32_t FullscreenSkillHotkey;      // å…¨å±æŠ€èƒ½çƒ­é”®
    int32_t HotkeyEnabled;               // çƒ­é”®æ€»å¼€å…³
    wchar_t PlayerName[32];              // ç©å®¶åï¼ˆUTF-16ï¼‰

    // ========== V6 æ–°å¢å­—æ®µï¼ˆ152-167 å­—èŠ‚ï¼‰==========
    int32_t RoomCleared;                 // ã€AradVisionã€‘æˆ¿é—´æ˜¯å¦å·²æ¸…ç©º
    int32_t DoorOpen;                    // ã€AradVisionã€‘é—¨æ˜¯å¦å·²å¼€å¯
    int32_t MonsterCount;                // ã€AradVisionã€‘å½“å‰æˆ¿é—´æ€ªç‰©æ•°é‡
    int32_t MapTeleportReady;            // ã€AradVisionã€‘è¿‡å›¾CALLæ˜¯å¦å°±ç»ª
};
#pragma pack(pop)
```

**C++ æ ¡éªŒåŸºçº¿ï¼ˆstatic_assertï¼‰**ï¼š

```cpp
#include <cstddef>

static_assert(sizeof(HelperStatusV6) == 168, "HelperStatusV6 size mismatch");
static_assert(offsetof(HelperStatusV6, PlayerName) == 88, "HelperStatusV6.PlayerName offset mismatch");
static_assert(offsetof(HelperStatusV6, RoomCleared) == 152, "HelperStatusV6.RoomCleared offset mismatch");
static_assert(offsetof(HelperStatusV6, DoorOpen) == 156, "HelperStatusV6.DoorOpen offset mismatch");
static_assert(offsetof(HelperStatusV6, MonsterCount) == 160, "HelperStatusV6.MonsterCount offset mismatch");
static_assert(offsetof(HelperStatusV6, MapTeleportReady) == 164, "HelperStatusV6.MapTeleportReady offset mismatch");
```

**Python ç‰ˆæœ¬**ï¼š

```python
import ctypes

class HelperStatusV6(ctypes.Structure):
    _pack_ = 1  # ç¦æ­¢å¯¹é½

    _fields_ = [
        # V5 åŸæœ‰å­—æ®µ
        ("Version", ctypes.c_uint32),
        ("Size", ctypes.c_uint32),
        ("LastTickMs", ctypes.c_uint64),
        ("Pid", ctypes.c_uint32),
        ("ProcessAlive", ctypes.c_int32),
        ("AutoTransparentEnabled", ctypes.c_int32),
        ("FullscreenAttackTarget", ctypes.c_int32),
        ("FullscreenAttackPatchOn", ctypes.c_int32),
        ("AttractMode", ctypes.c_int32),
        ("AttractPositive", ctypes.c_int32),
        ("GatherItemsEnabled", ctypes.c_int32),
        ("DamageEnabled", ctypes.c_int32),
        ("DamageMultiplier", ctypes.c_int32),
        ("InvincibleEnabled", ctypes.c_int32),
        ("SummonEnabled", ctypes.c_int32),
        ("SummonLastTick", ctypes.c_uint64),
        ("FullscreenSkillEnabled", ctypes.c_int32),
        ("FullscreenSkillActive", ctypes.c_int32),
        ("FullscreenSkillHotkey", ctypes.c_uint32),
        ("HotkeyEnabled", ctypes.c_int32),
        ("PlayerName", ctypes.c_wchar * 32),

        # V6 æ–°å¢å­—æ®µ
        ("RoomCleared", ctypes.c_int32),
        ("DoorOpen", ctypes.c_int32),
        ("MonsterCount", ctypes.c_int32),
        ("MapTeleportReady", ctypes.c_int32),
    ]
```

#### å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | åç§»é‡ | è¯´æ˜ | æœ‰æ•ˆå€¼ | ç”¨é€” |
|------|------|--------|------|--------|------|
| **Version** | uint32 | 0 | åè®®ç‰ˆæœ¬å· | **6** | åè®®æ ¡éªŒ |
| **Size** | uint32 | 4 | ç»“æ„ä½“å¤§å° | **168** | åè®®æ ¡éªŒ |
| **LastTickMs** | uint64 | 8 | å¿ƒè·³æ—¶é—´æˆ³ | æ¯«ç§’ | å­˜æ´»æ£€æµ‹ |
| **RoomCleared** | int32 | **152** | **æˆ¿é—´æ¸…ç©ºçŠ¶æ€** | 0/1 | Botå†³ç­– |
| **DoorOpen** | int32 | **156** | **é—¨å¼€å¯çŠ¶æ€** | 0/1 | è¿‡å›¾æ¡ä»¶ |
| **MonsterCount** | int32 | **160** | **æ€ªç‰©æ•°é‡** | 0~N | è¾…åŠ©åˆ¤æ–­ |
| **MapTeleportReady** | int32 | **164** | **è¿‡å›¾CALLå°±ç»ª** | 0/1 | é˜²è¯¯è§¦å‘ |

**å­—æ®µè¯­ä¹‰**ï¼š

- `RoomCleared = 1`ï¼šå½“å‰æˆ¿é—´æ‰€æœ‰æ€ªç‰©å·²æ¸…é™¤ï¼Œå¯ä»¥è¿›å…¥ä¸‹ä¸€åœ°å›¾
- `DoorOpen = 1`ï¼šä¸‹ä¸€åœ°å›¾çš„é—¨å·²å¼€å¯ï¼ˆDNFä¸­æ€ªç‰©å…¨æ¸…åé—¨æ‰ä¼šå¼€ï¼‰
- `MonsterCount`ï¼šå½“å‰æˆ¿é—´å­˜æ´»çš„æ€ªç‰©æ•°é‡ï¼ˆè¾…åŠ©éªŒè¯ï¼‰
- `MapTeleportReady = 1`ï¼šC++è¿‡å›¾CALLæ¨¡å—å·²å°±ç»ªï¼Œå¯ä»¥æ¥å—æ§åˆ¶æŒ‡ä»¤

#### å†…å­˜å¸ƒå±€

```
åç§»é‡    å­—æ®µå                    å¤§å°
----------------------------------------------------
0x00     Version                  4 bytes
0x04     Size                     4 bytes
0x08     LastTickMs               8 bytes
0x10     Pid                      4 bytes
0x14     ProcessAlive             4 bytes
...      (V5 åŸæœ‰å­—æ®µçœç•¥)         ...
0x58     PlayerName[32]           64 bytes (wchar_t)
0x98     RoomCleared              4 bytes  â¬… AradVision ä½¿ç”¨
0x9C     DoorOpen                 4 bytes  â¬… AradVision ä½¿ç”¨
0xA0     MonsterCount             4 bytes  â¬… AradVision ä½¿ç”¨
0xA4     MapTeleportReady         4 bytes  â¬… AradVision ä½¿ç”¨
----------------------------------------------------
Total                             168 bytes (0xA8)
```

---

### é€šé“äºŒï¼šHelperControlV5ï¼ˆæ§åˆ¶é€šé“ï¼‰

**ç”¨é€”**ï¼šAradVision â†’ game-allï¼Œè§¦å‘è¿‡å›¾CALL

#### å‘½åè§„åˆ™

```
Local\GameHelperControl_{pid}
Global\GameHelperControl_{pid}
```

#### ç»“æ„ä½“å®šä¹‰

**C++ ç‰ˆæœ¬**ï¼š

```cpp
#pragma pack(push, 1)
struct HelperControlV5 {
    // ========== V4 åŸæœ‰å­—æ®µï¼ˆ0-55 å­—èŠ‚ï¼‰==========
    uint32_t Version;                    // = 5
    uint32_t Size;                       // = 60
    uint32_t Pid;                        // ç›®æ ‡è¿›ç¨‹ PID
    uint32_t LastUpdateTick;             // æœ€è¿‘æ›´æ–°æ—¶é—´ï¼ˆTickCountï¼‰
    uint8_t FullscreenAttack;            // å…¨å±æ”»å‡»è¦†ç›–æ¨¡å¼
    uint8_t FullscreenSkill;             // å…¨å±æŠ€èƒ½è¦†ç›–æ¨¡å¼
    uint8_t AutoTransparent;             // è‡ªåŠ¨é€æ˜è¦†ç›–æ¨¡å¼
    uint8_t Attract;                     // å¸æ€ªè¦†ç›–æ¨¡å¼
    uint8_t HotkeyEnabled;               // çƒ­é”®è¦†ç›–æ¨¡å¼
    uint8_t Reserved0;                   // ä¿ç•™ï¼ˆä¸ V4 å¯¹é½ï¼‰
    uint8_t Reserved1;                   // ä¿ç•™ï¼ˆä¸ V4 å¯¹é½ï¼‰
    uint8_t Reserved2;                   // ä¿ç•™ï¼ˆä¸ V4 å¯¹é½ï¼‰
    uint32_t SummonSequence;             // å¬å”¤åºåˆ—å·
    uint32_t ActionSequence;             // åŠ¨ä½œåºåˆ—å·
    uint32_t ActionMask;                 // åŠ¨ä½œæ©ç 
    uint8_t DesiredFullscreenAttack;     // ç›®æ ‡ï¼šå…¨å±æ”»å‡»å¼€å…³
    uint8_t DesiredFullscreenSkill;      // ç›®æ ‡ï¼šå…¨å±æŠ€èƒ½æ¿€æ´»
    uint8_t DesiredAutoTransparent;      // ç›®æ ‡ï¼šè‡ªåŠ¨é€æ˜å¼€å…³
    uint8_t DesiredAttractEnabled;       // ç›®æ ‡ï¼šå¸æ€ªå¼€å…³
    uint8_t DesiredAttractMode;          // ç›®æ ‡ï¼šå¸æ€ªæ¡£ä½ï¼ˆ1~4ï¼‰
    uint8_t DesiredAttractPositive;      // ç›®æ ‡ï¼šå¸æ€ªæ–¹å‘ï¼ˆ1=æ­£å‘ï¼Œ0=è´Ÿå‘ï¼‰
    uint8_t DesiredHotkeyEnabled;        // ç›®æ ‡ï¼šçƒ­é”®æ€»å¼€å…³
    uint8_t DesiredGatherItemsEnabled;   // ç›®æ ‡ï¼šèšç‰©å¼€å…³
    uint32_t DesiredDamageMultiplier;    // ç›®æ ‡ï¼šåŠ¨æ€å€æ”»å€ç‡
    uint8_t DesiredDamageEnabled;        // ç›®æ ‡ï¼šåŠ¨æ€å€æ”»å¼€å…³
    uint8_t DesiredInvincibleEnabled;    // ç›®æ ‡ï¼šæ€ªç‰©é›¶ä¼¤å¼€å…³
    uint8_t Reserved3;                   // ä¿ç•™ï¼ˆä¸ V4 å¯¹é½ï¼‰
    uint8_t Reserved4;                   // ä¿ç•™ï¼ˆä¸ V4 å¯¹é½ï¼‰
    uint8_t Reserved5;                   // ä¿ç•™ï¼ˆä¸ V4 å¯¹é½ï¼‰
    uint8_t Reserved6;                   // ä¿ç•™ï¼ˆä¸ V4 å¯¹é½ï¼‰
    uint8_t Reserved7;                   // ä¿ç•™ï¼ˆä¸ V4 å¯¹é½ï¼‰
    uint8_t Reserved8;                   // ä¿ç•™ï¼ˆä¸ V4 å¯¹é½ï¼‰

    // ========== V5 æ–°å¢å­—æ®µï¼ˆ56-59 å­—èŠ‚ï¼‰==========
    uint8_t TeleportDirection;           // ã€AradVisionã€‘è¿‡å›¾æ–¹å‘
    uint8_t TeleportTrigger;             // ã€AradVisionã€‘è§¦å‘æ ‡å¿—
    uint8_t TeleportReserved0;           // é¢„ç•™æ‰©å±•
    uint8_t TeleportReserved1;           // é¢„ç•™æ‰©å±•
};
#pragma pack(pop)
```

**C++ æ ¡éªŒåŸºçº¿ï¼ˆstatic_assertï¼‰**ï¼š

```cpp
#include <cstddef>

static_assert(sizeof(HelperControlV5) == 60, "HelperControlV5 size mismatch");
static_assert(offsetof(HelperControlV5, SummonSequence) == 24, "HelperControlV5.SummonSequence offset mismatch");
static_assert(offsetof(HelperControlV5, DesiredDamageMultiplier) == 44, "HelperControlV5.DesiredDamageMultiplier offset mismatch");
static_assert(offsetof(HelperControlV5, TeleportDirection) == 56, "HelperControlV5.TeleportDirection offset mismatch");
static_assert(offsetof(HelperControlV5, TeleportTrigger) == 57, "HelperControlV5.TeleportTrigger offset mismatch");
```

**Python ç‰ˆæœ¬**ï¼š

```python
class HelperControlV5(ctypes.Structure):
    _pack_ = 1

    _fields_ = [
        # V4 åŸæœ‰å­—æ®µ
        ("Version", ctypes.c_uint32),
        ("Size", ctypes.c_uint32),
        ("Pid", ctypes.c_uint32),
        ("LastUpdateTick", ctypes.c_uint32),
        ("FullscreenAttack", ctypes.c_uint8),
        ("FullscreenSkill", ctypes.c_uint8),
        ("AutoTransparent", ctypes.c_uint8),
        ("Attract", ctypes.c_uint8),
        ("HotkeyEnabled", ctypes.c_uint8),
        ("Reserved0", ctypes.c_uint8),
        ("Reserved1", ctypes.c_uint8),
        ("Reserved2", ctypes.c_uint8),
        ("SummonSequence", ctypes.c_uint32),
        ("ActionSequence", ctypes.c_uint32),
        ("ActionMask", ctypes.c_uint32),
        ("DesiredFullscreenAttack", ctypes.c_uint8),
        ("DesiredFullscreenSkill", ctypes.c_uint8),
        ("DesiredAutoTransparent", ctypes.c_uint8),
        ("DesiredAttractEnabled", ctypes.c_uint8),
        ("DesiredAttractMode", ctypes.c_uint8),
        ("DesiredAttractPositive", ctypes.c_uint8),
        ("DesiredHotkeyEnabled", ctypes.c_uint8),
        ("DesiredGatherItemsEnabled", ctypes.c_uint8),
        ("DesiredDamageMultiplier", ctypes.c_uint32),
        ("DesiredDamageEnabled", ctypes.c_uint8),
        ("DesiredInvincibleEnabled", ctypes.c_uint8),
        ("Reserved3", ctypes.c_uint8),
        ("Reserved4", ctypes.c_uint8),
        ("Reserved5", ctypes.c_uint8),
        ("Reserved6", ctypes.c_uint8),
        ("Reserved7", ctypes.c_uint8),
        ("Reserved8", ctypes.c_uint8),

        # V5 æ–°å¢å­—æ®µ
        ("TeleportDirection", ctypes.c_uint8),
        ("TeleportTrigger", ctypes.c_uint8),
        ("TeleportReserved0", ctypes.c_uint8),
        ("TeleportReserved1", ctypes.c_uint8),
    ]
```

#### è¿‡å›¾æ–¹å‘æšä¸¾

```cpp
enum TeleportDirection : uint8_t {
    NONE = 0,  // æ— æ“ä½œ
    UP = 1,    // ä¸Šæ–¹åœ°å›¾
    DOWN = 2,  // ä¸‹æ–¹åœ°å›¾
    LEFT = 3,  // å·¦ä¾§åœ°å›¾
    RIGHT = 4  // å³ä¾§åœ°å›¾
};
```

```python
class TeleportDirection(IntEnum):
    NONE = 0
    UP = 1
    DOWN = 2
    LEFT = 3
    RIGHT = 4
```

#### å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | åç§»é‡ | è¯´æ˜ | æœ‰æ•ˆå€¼ |
|------|------|--------|------|--------|
| **Version** | uint32 | 0 | åè®®ç‰ˆæœ¬å· | **5** |
| **Size** | uint32 | 4 | ç»“æ„ä½“å¤§å° | **60** |
| **TeleportDirection** | uint8 | **56** | **è¿‡å›¾æ–¹å‘** | 0~4 |
| **TeleportTrigger** | uint8 | **57** | **è§¦å‘æ ‡å¿—** | 0/1 |

**è§¦å‘æœºåˆ¶ï¼ˆè¾¹æ²¿è§¦å‘ï¼‰**ï¼š

```cpp
// C++ ä¾§æ£€æµ‹é€»è¾‘
uint8_t lastTrigger = control->TeleportTrigger;
// è¯»å–æ–°çŠ¶æ€...
if (control->TeleportTrigger != lastTrigger && control->TeleportTrigger == 1) {
    // è§¦å‘ä¸€æ¬¡è¿‡å›¾CALL
    switch (control->TeleportDirection) {
        case TeleportDirection::UP:    TeleportUp(); break;
        case TeleportDirection::DOWN:  TeleportDown(); break;
        case TeleportDirection::LEFT:  TeleportLeft(); break;
        case TeleportDirection::RIGHT: TeleportRight(); break;
    }
}
```

#### å†…å­˜å¸ƒå±€

```
åç§»é‡    å­—æ®µå                    å¤§å°
----------------------------------------------------
...      (V4 åŸæœ‰å­—æ®µçœç•¥)         ...
0x38     â”Œâ”€ V4 ç»“æŸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€ 56 bytes
0x38     â”‚
0x38     â”œâ”€ TeleportDirection      1 byte   â¬… AradVision ä½¿ç”¨
0x39     â”‚  TeleportTrigger        1 byte   â¬… AradVision ä½¿ç”¨
0x3A     â”‚  TeleportReserved0      1 byte
0x3B     â””â”€ TeleportReserved1      1 byte
----------------------------------------------------
Total                             60 bytes (0x3C)
```

---

## ğŸ”„ åä½œæµç¨‹

### å®Œæ•´å·¥ä½œæµç¨‹

```mermaid
graph TD
    A[æ¸¸æˆè¿è¡Œä¸­] --> B[C++ æ£€æµ‹æ¸¸æˆçŠ¶æ€]
    B --> C[å†™å…¥ HelperStatusV6]
    C --> D[Python è¯»å–çŠ¶æ€]

    D --> E{RoomCleared == 1?}
    E -->|No| B
    E -->|Yes| F[è§†è§‰æ£€æµ‹é—¨æ–¹å‘]

    F --> G{æ£€æµ‹åˆ°æ–¹å‘?}
    G -->|No| B
    G -->|Yes| H[å†™å…¥ HelperControlV5]

    H --> I[TeleportDirection = æ–¹å‘]
    I --> J[TeleportTrigger 0â†’1]
    J --> K[C++ è¯»å–æ§åˆ¶]

    K --> L[æ‰§è¡Œè¿‡å›¾CALL]
    L --> M[åˆ‡æ¢åˆ°ä¸‹ä¸€åœ°å›¾]
    M --> A
```

### æ—¶åºå›¾

```
æ—¶é—´è½´  C++ (game-all)           å…±äº«å†…å­˜              Python (AradVision)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  t0    æ£€æµ‹åˆ°æˆ¿é—´æ¸…ç©º          Status.RoomCleared = 1
  t1    æ£€æµ‹åˆ°é—¨å·²å¼€å¯          Status.DoorOpen = 1
  t2    å†™å…¥çŠ¶æ€å®Œæˆ
                                â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  è¯»å–çŠ¶æ€
  t3                                                  room_cleared = True
  t4                                                  è§†è§‰æ£€æµ‹é—¨æ–¹å‘
  t5                                                  direction = RIGHT
                                                      å†™å…¥æ§åˆ¶
                                â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  Control.Direction = 4
                                                      Control.Trigger = 1
  t6    è¯»å–æ§åˆ¶
  t7    æ£€æµ‹åˆ° Trigger è¾¹æ²¿
  t8    æ‰§è¡Œ TeleportRight()
  t9    åˆ‡æ¢åœ°å›¾å®Œæˆ
                                Status.RoomCleared = 0
```

---

## ğŸ’» Python API ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨

```python
from core.cpp_bridge import CppBridge, TeleportDirection
import win32gui
import win32process

# 1. è·å–æ¸¸æˆè¿›ç¨‹ PID
hwnd = win32gui.FindWindow(None, "åœ°ä¸‹åŸä¸å‹‡å£«")
_, pid = win32process.GetWindowThreadProcessId(hwnd)

# 2. åˆ›å»ºæ¡¥æ¥å™¨
bridge = CppBridge(pid)

# 3. è¯»å–æ¸¸æˆçŠ¶æ€
state = bridge.read_state()
if state:
    print(f"æˆ¿é—´æ¸…ç©º: {state['room_cleared']}")
    print(f"é—¨å·²å¼€å¯: {state['door_open']}")
    print(f"æ€ªç‰©æ•°é‡: {state['monster_count']}")

    # 4. åˆ¤æ–­æ˜¯å¦éœ€è¦è¿‡å›¾
    if state['room_cleared'] and state['door_open']:
        # 5. æ£€æµ‹é—¨æ–¹å‘ï¼ˆè§†è§‰è¯†åˆ«ï¼‰
        direction = detect_door_direction()  # è¿”å› TeleportDirection.RIGHT

        # 6. è§¦å‘è¿‡å›¾CALL
        success = bridge.teleport(direction)
        if success:
            print("âœ“ è¿‡å›¾æˆåŠŸï¼Œç­‰å¾…æ–°åœ°å›¾åŠ è½½...")

# 7. å…³é—­æ¡¥æ¥å™¨
bridge.close()
```

### Bot FSM é›†æˆ

```python
class BotFSM:
    def __init__(self, game_pid: int):
        self.cpp = CppBridge(game_pid)

    def update(self, ctx: GameContext) -> ActionCommand:
        # è¯»å– C++ çŠ¶æ€
        state = self.cpp.read_state()

        if state and state["room_cleared"]:
            # æˆ¿é—´å·²æ¸…ç©ºï¼Œæ£€æµ‹é—¨æ–¹å‘
            direction = self._detect_door_direction(ctx.frame)

            if direction != TeleportDirection.NONE:
                # è§¦å‘è¿‡å›¾
                self.cpp.teleport(direction)
                return ActionCommand.WAIT

        # æ­£å¸¸æˆ˜æ–—é€»è¾‘
        return self._combat_logic(ctx)
```

---

## âš ï¸ é”™è¯¯å¤„ç†

### åè®®ç‰ˆæœ¬ä¸åŒ¹é…

| ç—‡çŠ¶ | åŸå›  | å¤„ç†æ–¹å¼ |
|------|------|----------|
| `Version != 6` | C++ ä½¿ç”¨æ—§åè®® | è®°å½•è­¦å‘Šæ—¥å¿—ï¼Œè¿”å› None |
| `Size != 168` | ç»“æ„ä½“å®šä¹‰é”™è¯¯ | è®°å½•è­¦å‘Šæ—¥å¿—ï¼Œè¿”å› None |

**Python å¤„ç†ç¤ºä¾‹**ï¼š

```python
struct = HelperStatusV6.from_buffer_copy(buffer)
if struct.Version != 6 or struct.Size != 168:
    logger.warning(f"åè®®ä¸åŒ¹é…: V{struct.Version}, Size={struct.Size}")
    return None  # é™çº§åˆ°çº¯è§†è§‰æ¨¡å¼
```

### å…±äº«å†…å­˜ä¸å­˜åœ¨

| ç—‡çŠ¶ | åŸå›  | å¤„ç†æ–¹å¼ |
|------|------|----------|
| `OpenFileMappingW` å¤±è´¥ | C++ æœªæ³¨å…¥æˆ–è¿›ç¨‹ä¸å­˜åœ¨ | æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ‡æ¢åˆ°çº¯è§†è§‰æ¨¡å¼ |

**Python å¤„ç†ç¤ºä¾‹**ï¼š

```python
try:
    handle = win32file.OpenFileMappingW(...)
except win32file.error:
    logger.error("æ— æ³•æ‰“å¼€å…±äº«å†…å­˜ï¼ŒC++ å¯èƒ½æœªæ³¨å…¥")
    raise CppBridgeUnavailable  # åˆ‡æ¢åˆ°çº¯è§†è§‰æ¨¡å¼
```

### å¿ƒè·³è¶…æ—¶

| ç—‡çŠ¶ | åŸå›  | å¤„ç†æ–¹å¼ |
|------|------|----------|
| `LastTickMs` è¶…è¿‡ 3 ç§’ | C++ è¿›ç¨‹å´©æºƒ/æŒ‚èµ· | æ ‡è®°çŠ¶æ€æ— æ•ˆï¼Œåœæ­¢ä½¿ç”¨ |

**Python å¤„ç†ç¤ºä¾‹**ï¼š

```python
import time

current_ms = int(time.time() * 1000)
if current_ms - state["timestamp_ms"] > 3000:
    logger.warning("C++ å¿ƒè·³è¶…æ—¶ï¼ŒçŠ¶æ€å¯èƒ½å¤±æ•ˆ")
    return None
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
|------|--------|------|
| **çŠ¶æ€è¯»å–å»¶è¿Ÿ** | <0.1ms | å…±äº«å†…å­˜ç›´æ¥è¯»å– |
| **æ§åˆ¶å†™å…¥å»¶è¿Ÿ** | <0.1ms | å…±äº«å†…å­˜ç›´æ¥å†™å…¥ |
| **è¿‡å›¾CALLæ‰§è¡Œæ—¶é—´** | <100ms | å–å†³äºæ¸¸æˆåŠ è½½é€Ÿåº¦ |
| **åè®®å†…å­˜å ç”¨** | 228 bytes | Status(168) + Control(60) |

---

## ğŸ“š ä¾èµ–å…³ç³»

### Python ä¾èµ–

```bash
# å¿…éœ€
pip install pywin32

# å¯é€‰ï¼ˆç”¨äºæ—¥å¿—ï¼‰
pip install loguru
```

### C++ ä¾èµ–

- Windows SDKï¼ˆå…±äº«å†…å­˜ APIï¼‰
- C++11 æˆ–æ›´é«˜ç‰ˆæœ¬
- ä¸åŸæœ‰ V5/V4 åè®®å…¼å®¹

---

## ğŸ”§ è°ƒè¯•å·¥å…·

### Process Explorer

**éªŒè¯å…±äº«å†…å­˜æ˜¯å¦å­˜åœ¨**ï¼š

1. æ‰“å¼€ Process Explorer
2. æŸ¥æ‰¾ç›®æ ‡è¿›ç¨‹ï¼ˆæ¸¸æˆè¿›ç¨‹ï¼‰
3. æŸ¥çœ‹ `Handles` â†’ æœç´¢ `GameHelperStatus`
4. ç¡®è®¤ `Size` æ˜¯å¦ä¸º 168

### Python è°ƒè¯•è„šæœ¬

```python
# debug_cpp_bridge.py
from core.cpp_bridge import CppBridge

pid = 1234  # æ›¿æ¢ä¸ºå®é™… PID

with CppBridge(pid) as bridge:
    # æ‰“å°åŸå§‹æ•°æ®
    import ctypes
    struct = HelperStatusV6.from_buffer_copy(bridge.status_buffer)
    print(f"Version: {struct.Version}")
    print(f"RoomCleared: {struct.RoomCleared}")
    print(f"DoorOpen: {struct.DoorOpen}")
    print(f"MonsterCount: {struct.MonsterCount}")
```

---

## ğŸ“ ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ |
|------|------|----------|
| **V1.0** | 2025-02-27 | åˆå§‹ç‰ˆæœ¬<br>- å®šä¹‰ HelperStatusV6ï¼ˆ168å­—èŠ‚ï¼‰<br>- å®šä¹‰ HelperControlV5ï¼ˆ60å­—èŠ‚ï¼‰<br>- æ–°å¢è¿‡å›¾æ§åˆ¶èƒ½åŠ› |

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [game-all é¡¹ç›® README](./C++é¡¹ç›®_README.md)
- [AradVision æ¶æ„è®¾è®¡](../æ¶æ„è®¾è®¡.md)
- [Bot FSM çŠ¶æ€æœºè®¾è®¡](../Bot_FSMè®¾è®¡.md)

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰åè®®é—®é¢˜ï¼Œè¯·è”ç³»ï¼š
- **AradVision é¡¹ç›®ç»„**ï¼šGitHub Issues
- **game-all é¡¹ç›®ç»„**ï¼šè§é¡¹ç›® README

---

**æœ€åæ›´æ–°**ï¼š2025-02-27
