# DNF é—¨çŠ¶æ€æ£€æµ‹æŠ€æœ¯æ–‡æ¡£

> ç”¨äºæ£€æµ‹å½“å‰æˆ¿é—´æ€ªç‰©æ˜¯å¦å®Œå…¨æ¸…é™¤ä»¥åŠè¿›å…¥ä¸‹ä¸€æˆ¿é—´çš„å®Œæ•´æŠ€æœ¯æ–¹æ¡ˆ

---

## ğŸ“Œ ç›®å½•

- [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
- [æ ¸å¿ƒæŠ€æœ¯åŸç†](#æ ¸å¿ƒæŠ€æœ¯åŸç†)
- [å†…å­˜åœ°å€æ˜ å°„è¡¨](#å†…å­˜åœ°å€æ˜ å°„è¡¨)
- [ä»£ç å®ç°](#ä»£ç å®ç°)
- [é›†æˆæŒ‡å—](#é›†æˆæŒ‡å—)
- [å®Œæ•´ç¤ºä¾‹ä»£ç ](#å®Œæ•´ç¤ºä¾‹ä»£ç )
- [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)

---

## åŠŸèƒ½æ¦‚è¿°

æœ¬æ–¹æ¡ˆæä¾›ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š

| åŠŸèƒ½ | æè¿° |
|------|------|
| **é—¨çŠ¶æ€æ£€æµ‹** | æ£€æµ‹å½“å‰æˆ¿é—´æ€ªç‰©æ˜¯å¦å·²æ¸…é™¤ï¼Œé—¨æ˜¯å¦å·²æ‰“å¼€ |
| **è¿‡å›¾è°ƒç”¨** | é€šè¿‡æ¸¸æˆå†…éƒ¨CALLç›´æ¥è¿›å…¥ä¸‹ä¸€æˆ¿é—´ |

---

## æ ¸å¿ƒæŠ€æœ¯åŸç†

### é—¨çŠ¶æ€æ£€æµ‹åŸç†

DNFæ¸¸æˆä¸­ï¼Œæˆ¿é—´é—¨çš„å¼€å…³çŠ¶æ€å­˜å‚¨åœ¨ç‰¹å®šå†…å­˜åœ°å€ä¸­ï¼š

```
å½“æˆ¿é—´å†…æ‰€æœ‰æ€ªç‰©è¢«æ¸…é™¤æ—¶ï¼Œæ¸¸æˆå†…éƒ¨ä¼šå°†é—¨çŠ¶æ€æ ‡è®°è®¾ä¸º 0
æ­¤æ—¶ç©å®¶å¯ä»¥è¿›å…¥ä¸‹ä¸€æˆ¿é—´
```

**æ£€æµ‹è·¯å¾„ï¼š**
```
äººç‰©åŸºå€ â†’ åœ°å›¾åç§» â†’ +280 â†’ è§£å¯†è¯»å–
```

### è¿‡å›¾åŸç†

é€šè¿‡è°ƒç”¨æ¸¸æˆå†…éƒ¨å‡½æ•°ï¼ˆè¿‡å›¾Callï¼‰ï¼Œä¼ å…¥æ–¹å‘å‚æ•°è§¦å‘æˆ¿é—´åˆ‡æ¢ï¼š

```
æˆ¿é—´ç¼–å· â†’ å†…éƒ¨å¯¹è±¡é“¾ â†’ è¿‡å›¾å‡½æ•° + æ–¹å‘å‚æ•°
```

---

## å†…å­˜åœ°å€æ˜ å°„è¡¨

### åŸºç¡€åŸºå€

| åç§° | åœ°å€ (åè¿›åˆ¶) | åœ°å€ (åå…­è¿›åˆ¶) | è¯´æ˜ |
|------|--------------|----------------|------|
| äººç‰©åŸºå€ | 81325736 | 0x4D8EEA8 | è§’è‰²å¯¹è±¡åŸºç¡€åœ°å€ |
| åœ°å›¾åç§» | 188 | 0xBC | åœ°å›¾å¯¹è±¡åç§»é‡ |
| æˆ¿é—´ç¼–å· | 80315732 | 0x4C98554 | å½“å‰æˆ¿é—´ä¿¡æ¯åŸºå€ |
| æ—¶é—´åŸºå€ | 2138152 | 0x20A028 | æˆ¿é—´ç»“æ„æ—¶é—´åŸºå€ |
| è¿‡å›¾Call | 22239664 | 0x15359B0 | è¿‡å›¾å‡½æ•°åœ°å€ |
| è§£å¯†åŸºå€ | 81589368 | 0x4DCF478 | æ•°æ®è§£å¯†å‡½æ•°åŸºå€ |

### å…³é”®åç§»

| åç§»ä½ç½® | è¯´æ˜ | æ•°æ®ç±»å‹ |
|---------|------|---------|
| åœ°å›¾åç§» + 280 | é—¨çŠ¶æ€æ ‡è®° | åŠ å¯†int |
| æ—¶é—´åŸºå€ + 0x20A024 | æˆ¿é—´ä¸€çº§å¯¹è±¡ | æŒ‡é’ˆ |
| + 0x8C | æˆ¿é—´äºŒçº§å¯¹è±¡ | æŒ‡é’ˆ |

---

## ä»£ç å®ç°

### 1. åŸºç¡€å·¥å…·å‡½æ•°

```cpp
#include <Windows.h>
#include <TlHelp32.h>

// è¿›ç¨‹å¥æŸ„ï¼ˆéœ€è¦é€šè¿‡è¿›ç¨‹åæˆ–çª—å£è·å–ï¼‰
HANDLE g_hProcess = NULL;

// è¯»å–å†…å­˜
template<typename T>
T ReadMemory(DWORD address) {
    T value = T();
    ReadProcessMemory(g_hProcess, (LPCVOID)address, &value, sizeof(T), NULL);
    return value;
}

// ç‰¹åŒ–çš„æŒ‡é’ˆè¯»å–
int ReadInt(DWORD address) {
    return ReadMemory<int>(address);
}

// ç®€å•è§£å¯†å‡½æ•°ï¼ˆæ ¹æ®å®é™…æ¸¸æˆç‰ˆæœ¬è°ƒæ•´ï¼‰
int Decrypt(int value) {
    // DNFä½¿ç”¨ç®€å•çš„å¼‚æˆ–åŠ å¯†
    return value ^ 0x4DCF478;  // è§£å¯†åŸºå€ä½œä¸ºå¯†é’¥
}
```

### 2. é—¨çŠ¶æ€æ£€æµ‹å‡½æ•°

```cpp
// æ£€æµ‹å½“å‰æˆ¿é—´çš„é—¨æ˜¯å¦å·²æ‰“å¼€ï¼ˆæ€ªç‰©æ˜¯å¦å·²æ¸…é™¤ï¼‰
bool IsDoorOpen() {
    const DWORD äººç‰©åŸºå€ = 0x81325736;
    const DWORD åœ°å›¾åç§» = 0xBC;

    // è·å–äººç‰©å¯¹è±¡
    int playerBase = ReadInt(äººç‰©åŸºå€);
    if (playerBase == 0) return false;

    // è·å–åœ°å›¾å¯¹è±¡
    int mapBase = ReadInt(playerBase + åœ°å›¾åç§»);
    if (mapBase == 0) return false;

    // è¯»å–é—¨çŠ¶æ€ï¼ˆ+280åç§»ï¼‰
    int doorStateEncrypted = ReadInt(mapBase + 280);
    int doorState = Decrypt(doorStateEncrypted);

    // 0è¡¨ç¤ºé—¨å·²æ‰“å¼€
    return doorState == 0;
}
```

### 3. è¿‡å›¾è°ƒç”¨å‡½æ•°

```cpp
// æ–¹å‘æšä¸¾
enum class DoorDirection {
    LEFT = 0,   // å·¦
    RIGHT = 1,  // å³
    UP = 2,     // ä¸Š
    DOWN = 3    // ä¸‹
};

// ä½¿ç”¨å†…è”æ±‡ç¼–è°ƒç”¨è¿‡å›¾å‡½æ•°
void ChangeRoom(DoorDirection direction) {
    const DWORD æˆ¿é—´ç¼–å· = 0x80315732;
    const DWORD è¿‡å›¾Call = 0x22239664;

    __asm {
        // è·å–æˆ¿é—´å¯¹è±¡
        mov ecx, æˆ¿é—´ç¼–å·
        mov ecx, [ecx]
        mov ecx, [ecx + 0x20A024]
        mov ecx, [ecx + 0x8C]

        // å‹å…¥å‚æ•°
        push 0xFF
        push 0xFF
        push 0x00
        push 0x00
        push 0x00
        push 0x00
        push 0x00
        push direction  // æ–¹å‘å‚æ•°

        // è°ƒç”¨è¿‡å›¾å‡½æ•°
        mov eax, è¿‡å›¾Call
        call eax
    }
}
```

---

## é›†æˆæŒ‡å—

### æ­¥éª¤ 1ï¼šåˆå§‹åŒ–è¿›ç¨‹è®¿é—®

```cpp
// é€šè¿‡çª—å£æ ‡é¢˜è·å–DNFè¿›ç¨‹å¥æŸ„
HANDLE GetDNFProcessHandle() {
    HWND hwnd = FindWindowW(L"DNF Client", NULL);
    if (hwnd == NULL) {
        return NULL;
    }

    DWORD pid;
    GetWindowThreadProcessId(hwnd, &pid);

    return OpenProcess(PROCESS_ALL_ACCESS, FALSE, pid);
}

// åˆå§‹åŒ–
bool Initialize() {
    g_hProcess = GetDNFProcessHandle();
    return g_hProcess != NULL;
}
```

### æ­¥éª¤ 2ï¼šåŸºæœ¬ä½¿ç”¨

```cpp
// ç¤ºä¾‹ï¼šè‡ªåŠ¨è¿‡å›¾å¾ªç¯
void AutoChangeRoom() {
    if (!Initialize()) {
        printf("æ— æ³•è·å–DNFè¿›ç¨‹\n");
        return;
    }

    while (true) {
        if (IsDoorOpen()) {
            printf("é—¨å·²æ‰“å¼€ï¼Œå‡†å¤‡è¿‡å›¾...\n");
            Sleep(500);
            ChangeRoom(DoorDirection::RIGHT);  // å‘å³è¿‡å›¾
            Sleep(1000);
        }

        Sleep(100);
    }
}
```

### æ­¥éª¤ 3ï¼šè·å–è¿›ç¨‹å¥æŸ„çš„å…¶ä»–æ–¹å¼

```cpp
// é€šè¿‡è¿›ç¨‹åè·å–
HANDLE GetProcessByName(const wchar_t* processName) {
    DWORD pid = 0;
    HANDLE snapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0);

    PROCESSENTRY32W pe32;
    pe32.dwSize = sizeof(PROCESSENTRY32W);

    if (Process32FirstW(snapshot, &pe32)) {
        do {
            if (wcscmp(pe32.szExeFile, processName) == 0) {
                pid = pe32.th32ProcessID;
                break;
            }
        } while (Process32NextW(snapshot, &pe32));
    }

    CloseHandle(snapshot);

    if (pid > 0) {
        return OpenProcess(PROCESS_ALL_ACCESS, FALSE, pid);
    }
    return NULL;
}
```

---

## å®Œæ•´ç¤ºä¾‹ä»£ç 

```cpp
// DNFDoorDetector.h
#pragma once
#include <Windows.h>

class DNFDoorDetector {
public:
    // åœ°å€å¸¸é‡
    static const DWORD ADDR_PLAYER_BASE = 0x81325736;
    static const DWORD ADDR_MAP_OFFSET = 0xBC;
    static const DWORD ADDR_ROOM_INFO = 0x80315732;
    static const DWORD ADDR_CHANGE_ROOM_CALL = 0x22239664;
    static const DWORD ADDR_DECRYPT_BASE = 0x4DCF478;

    // æ–¹å‘æšä¸¾
    enum Direction {
        DIR_LEFT = 0,
        DIR_RIGHT = 1,
        DIR_UP = 2,
        DIR_DOWN = 3
    };

    // åˆå§‹åŒ–
    bool Init();

    // æ£€æµ‹é—¨æ˜¯å¦æ‰“å¼€
    bool IsDoorOpen();

    // è¿‡å›¾
    void ChangeRoom(Direction dir);

    // æ˜¯å¦åœ¨å‰¯æœ¬ä¸­
    bool IsInDungeon();

private:
    HANDLE m_hProcess;
    int Decrypt(int value);

    template<typename T>
    T ReadMemory(DWORD addr);
};
```

```cpp
// DNFDoorDetector.cpp
#include "DNFDoorDetector.h"

bool DNFDoorDetector::Init() {
    // è·å–DNFçª—å£
    HWND hwnd = FindWindowW(L"DNF Client", NULL);
    if (!hwnd) return false;

    DWORD pid;
    GetWindowThreadProcessId(hwnd, &pid);

    m_hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, pid);
    return m_hProcess != NULL;
}

bool DNFDoorDetector::IsDoorOpen() {
    if (!m_hProcess) return false;

    // è¯»å–è·¯å¾„: äººç‰©åŸºå€ â†’ +åœ°å›¾åç§» â†’ +280 â†’ è§£å¯†
    int playerBase = ReadMemory<int>(ADDR_PLAYER_BASE);
    if (playerBase == 0) return false;

    int mapBase = ReadMemory<int>(playerBase + ADDR_MAP_OFFSET);
    if (mapBase == 0) return false;

    int doorState = ReadMemory<int>(mapBase + 280);
    doorState = Decrypt(doorState);

    return doorState == 0;
}

void DNFDoorDetector::ChangeRoom(Direction dir) {
    const DWORD offset1 = 0x20A024;
    const DWORD offset2 = 0x8C;

    __asm {
        mov ecx, ADDR_ROOM_INFO
        mov ecx, [ecx]
        mov ecx, [ecx + offset1]
        mov ecx, [ecx + offset2]

        push 0xFF
        push 0xFF
        push 0x00
        push 0x00
        push 0x00
        push 0x00
        push 0x00
        push dir

        mov eax, ADDR_CHANGE_ROOM_CALL
        call eax
    }
}

bool DNFDoorDetector::IsInDungeon() {
    if (!m_hProcess) return false;

    int playerBase = ReadMemory<int>(ADDR_PLAYER_BASE);
    if (playerBase == 0) return false;

    int mapBase = ReadMemory<int>(playerBase + ADDR_MAP_OFFSET);
    // åœ¨å‰¯æœ¬ä¸­ mapBase != 0ï¼Œåœ¨åŸé•‡ä¸­ mapBase == 0
    return mapBase != 0;
}

int DNFDoorDetector::Decrypt(int value) {
    return value ^ ADDR_DECRYPT_BASE;
}

template<typename T>
T DNFDoorDetector::ReadMemory(DWORD addr) {
    T value = T();
    ReadProcessMemory(m_hProcess, (LPCVOID)addr, &value, sizeof(T), NULL);
    return value;
}
```

```cpp
// main.cpp - ä½¿ç”¨ç¤ºä¾‹
#include "DNFDoorDetector.h"
#include <iostream>

int main() {
    DNFDoorDetector detector;

    if (!detector.Init()) {
        std::cout << "æ— æ³•è¿æ¥åˆ°DNFè¿›ç¨‹ï¼Œè¯·ç¡®ä¿æ¸¸æˆæ­£åœ¨è¿è¡Œ" << std::endl;
        return 1;
    }

    std::cout << "å·²è¿æ¥åˆ°DNFï¼Œå¼€å§‹ç›‘æ§é—¨çŠ¶æ€..." << std::endl;
    std::cout << "æŒ‰æ–¹å‘é”®æ‰‹åŠ¨è¿‡å›¾ï¼Œæˆ–æŒ‰ESCé€€å‡º" << std::endl;

    while (true) {
        if (GetAsyncKeyState(VK_ESCAPE)) {
            break;
        }

        // æ£€æµ‹é—¨çŠ¶æ€
        if (detector.IsInDungeon()) {
            bool doorOpen = detector.IsDoorOpen();

            if (doorOpen) {
                std::cout << "[é—¨çŠ¶æ€] å·²å¼€å¯ - å¯ä»¥è¿‡å›¾" << std::endl;

                // å¿«æ·é”®è¿‡å›¾
                if (GetAsyncKeyState(VK_LEFT)) {
                    detector.ChangeRoom(DNFDoorDetector::DIR_LEFT);
                    std::cout << "æ‰§è¡Œ: å‘å·¦è¿‡å›¾" << std::endl;
                    Sleep(500);
                }
                if (GetAsyncKeyState(VK_RIGHT)) {
                    detector.ChangeRoom(DNFDoorDetector::DIR_RIGHT);
                    std::cout << "æ‰§è¡Œ: å‘å³è¿‡å›¾" << std::endl;
                    Sleep(500);
                }
                if (GetAsyncKeyState(VK_UP)) {
                    detector.ChangeRoom(DNFDoorDetector::DIR_UP);
                    std::cout << "æ‰§è¡Œ: å‘ä¸Šè¿‡å›¾" << std::endl;
                    Sleep(500);
                }
                if (GetAsyncKeyState(VK_DOWN)) {
                    detector.ChangeRoom(DNFDoorDetector::DIR_DOWN);
                    std::cout << "æ‰§è¡Œ: å‘ä¸‹è¿‡å›¾" << std::endl;
                    Sleep(500);
                }
            } else {
                std::cout << "[é—¨çŠ¶æ€] æœªå¼€å¯ - è¿˜æœ‰æ€ªç‰©" << std::endl;
            }
        } else {
            std::cout << "[çŠ¶æ€] åœ¨åŸé•‡ä¸­" << std::endl;
        }

        Sleep(500);
    }

    std::cout << "ç¨‹åºå·²é€€å‡º" << std::endl;
    return 0;
}
```

---

## æ³¨æ„äº‹é¡¹

### âš ï¸ é‡è¦è­¦å‘Š

1. **æ¸¸æˆç‰ˆæœ¬å·®å¼‚**
   - ä¸åŒDNFç‰ˆæœ¬çš„å†…å­˜åœ°å€å¯èƒ½ä¸åŒ
   - éœ€è¦æ ¹æ®å®é™…ç‰ˆæœ¬è°ƒæ•´åŸºå€å’Œåç§»
   - å»ºè®®ä½¿ç”¨CEç­‰å·¥å…·è‡ªè¡Œæ‰«æç¡®è®¤

2. **åä½œå¼Šé£é™©**
   - æ­¤ç±»ä»£ç å±äºæ¸¸æˆè¾…åŠ©å·¥å…·
   - å¯èƒ½è¢«æ¸¸æˆåä½œå¼Šç³»ç»Ÿæ£€æµ‹
   - è¯·åœ¨åˆæ³•èŒƒå›´å†…ä½¿ç”¨ï¼ˆå¦‚ç§äººå­¦ä¹ ç ”ç©¶ï¼‰

3. **æƒé™è¦æ±‚**
   - éœ€è¦ç®¡ç†å‘˜æƒé™è¿è¡Œ
   - éœ€è¦å…³é—­æŸäº›å®‰å…¨è½¯ä»¶

4. **è§£å¯†ç®—æ³•**
   - ç¤ºä¾‹ä¸­çš„è§£å¯†æ˜¯ç®€åŒ–çš„
   - å®é™…æ¸¸æˆä¸­åŠ å¯†å¯èƒ½æ›´å¤æ‚
   - éœ€è¦æ ¹æ®ç‰ˆæœ¬è°ƒæ•´è§£å¯†é€»è¾‘

### ğŸ” åœ°å€æ‰«ææ–¹æ³•

å¦‚æœåœ°å€å¤±æ•ˆï¼Œå¯ç”¨ä»¥ä¸‹æ–¹æ³•é‡æ–°æ‰«æï¼š

1. **æ‰“å¼€æ¸¸æˆï¼Œè¿›å…¥å‰¯æœ¬**
2. **ä½¿ç”¨CEæœç´¢ç‰¹å¾å€¼ï¼š**
   - é—¨å…³é—­æ—¶ï¼šé0å€¼
   - é—¨å¼€å¯æ—¶ï¼š0
3. **æ‰¾å‡ºåŸºå€å’Œåç§»é“¾**
4. **æ›´æ–°ä»£ç ä¸­çš„å¸¸é‡**

### ğŸ“ è°ƒè¯•å»ºè®®

```cpp
// è°ƒè¯•è¾“å‡ºè¾…åŠ©å‡½æ•°
void DebugPrint(const char* format, ...) {
    char buffer[256];
    va_list args;
    va_start(args, format);
    vsnprintf(buffer, sizeof(buffer), format, args);
    va_end(args);

    // è¾“å‡ºåˆ°æ–‡ä»¶æˆ–è°ƒè¯•å™¨
    OutputDebugStringA(buffer);
}
```

---

## æ‰©å±•åŠŸèƒ½

### æ£€æµ‹å½“å‰æ˜¯å¦åœ¨BOSSæˆ¿é—´

```cpp
bool IsInBossRoom() {
    const DWORD ADDR_TIME_BASE = 0x20A028;
    const DWORD OFFSET_BOSS_X = 0xB70;  // BOSSæˆ¿é—´Xåæ ‡åç§»
    const DWORD OFFSET_BOSS_Y = 0xB78;  // BOSSæˆ¿é—´Yåæ ‡åç§»
    const DWORD OFFSET_CUR_X = 0xAC4;   // å½“å‰æˆ¿é—´Xåæ ‡åç§»
    const DWORD OFFSET_CUR_Y = 0xACC;   // å½“å‰æˆ¿é—´Yåæ ‡åç§»
    const DWORD OFFSET_ROOM_BASE = 0xCC;

    int roomBase = ReadMemory<int>(ADDR_ROOM_INFO);
    if (roomBase == 0) return false;

    int timeBase = ReadMemory<int>(roomBase + ADDR_TIME_BASE);
    if (timeBase == 0) return false;

    int roomStruct = ReadMemory<int>(timeBase + OFFSET_ROOM_BASE);
    if (roomStruct == 0) return false;

    int bossX = Decrypt(ReadMemory<int>(roomStruct + OFFSET_BOSS_X));
    int bossY = Decrypt(ReadMemory<int>(roomStruct + OFFSET_BOSS_Y));
    int curX = ReadMemory<int>(roomStruct + OFFSET_CUR_X);
    int curY = ReadMemory<int>(roomStruct + OFFSET_CUR_Y);

    return (curX == bossX && curY == bossY);
}
```

---

## æ€»ç»“

æœ¬æŠ€æœ¯æ–‡æ¡£æä¾›äº†å®Œæ•´çš„DNFé—¨çŠ¶æ€æ£€æµ‹æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ï¼š

- âœ… é—¨çŠ¶æ€æ£€æµ‹åŸç†å’Œå®ç°
- âœ… è¿‡å›¾CALLè°ƒç”¨æ–¹æ³•
- âœ… å®Œæ•´çš„C++ä»£ç ç¤ºä¾‹
- âœ… é›†æˆåˆ°å…¶ä»–é¡¹ç›®çš„æŒ‡å—

**é€‚ç”¨åœºæ™¯ï¼š**
- è‡ªåŠ¨åˆ·å›¾è¾…åŠ©
- æˆ¿é—´çŠ¶æ€ç›‘æ§
- æ¸¸æˆè‡ªåŠ¨åŒ–å·¥å…·å¼€å‘

---

> æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0
> æœ€åæ›´æ–°ï¼š2026-02-27
> å…¼å®¹DNFç‰ˆæœ¬ï¼šéœ€æ ¹æ®å®é™…ç‰ˆæœ¬è°ƒæ•´åœ°å€
